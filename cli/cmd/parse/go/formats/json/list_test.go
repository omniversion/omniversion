package json

import (
	"github.com/stretchr/testify/assert"
	"testing"
)

func TestParseListOutput(t *testing.T) {
	vector := "{\n        \"Path\": \"github.com/omniversion/omniversion/cli\",\n        \"Main\": true,\n        \"Dir\": \"/Users/testor/Documents/Repositories/omniversion/cli\",\n        \"GoMod\": \"/Users/testor/Documents/Repositories/omniversion/cli/go.mod\",\n        \"GoVersion\": \"1.17\"\n}\n{\n        \"Path\": \"github.com/BurntSushi/toml\",\n        \"Version\": \"v1.1.0\",\n        \"Time\": \"2022-04-04T19:53:34Z\",\n        \"Dir\": \"/Users/testor/go/pkg/mod/github.com/!burnt!sushi/toml@v1.1.0\",\n        \"GoMod\": \"/Users/testor/go/pkg/mod/cache/download/github.com/!burnt!sushi/toml/@v/v1.1.0.mod\",\n        \"GoVersion\": \"1.16\"\n}\n{\n        \"Path\": \"github.com/cpuguy83/go-md2man/v2\",\n        \"Version\": \"v2.0.1\",\n        \"Time\": \"2021-07-16T23:20:56Z\",\n        \"Update\": {\n                \"Path\": \"github.com/cpuguy83/go-md2man/v2\",\n                \"Version\": \"v2.0.2\",\n                \"Time\": \"2022-04-22T22:25:44Z\"\n        },\n        \"Indirect\": true,\n        \"GoMod\": \"/Users/testor/go/pkg/mod/cache/download/github.com/cpuguy83/go-md2man/v2/@v/v2.0.1.mod\",\n        \"GoVersion\": \"1.11\"\n}\n{\n        \"Path\": \"github.com/davecgh/go-spew\",\n        \"Version\": \"v1.1.1\",\n        \"Time\": \"2018-02-21T23:26:28Z\",\n        \"Indirect\": true,\n        \"Dir\": \"/Users/testor/go/pkg/mod/github.com/davecgh/go-spew@v1.1.1\",\n        \"GoMod\": \"/Users/testor/go/pkg/mod/cache/download/github.com/davecgh/go-spew/@v/v1.1.1.mod\"\n}\n{\n        \"Path\": \"github.com/hashicorp/errwrap\",\n        \"Version\": \"v1.0.0\",\n        \"Time\": \"2018-08-24T00:39:10Z\",\n        \"Update\": {\n                \"Path\": \"github.com/hashicorp/errwrap\",\n                \"Version\": \"v1.1.0\",\n                \"Time\": \"2020-07-14T15:51:01Z\"\n        },\n        \"Indirect\": true,\n        \"Dir\": \"/Users/testor/go/pkg/mod/github.com/hashicorp/errwrap@v1.0.0\",\n        \"GoMod\": \"/Users/testor/go/pkg/mod/cache/download/github.com/hashicorp/errwrap/@v/v1.0.0.mod\"\n}\n{\n        \"Path\": \"github.com/hashicorp/go-multierror\",\n        \"Version\": \"v1.1.1\",\n        \"Time\": \"2021-03-11T20:17:12Z\",\n        \"Dir\": \"/Users/testor/go/pkg/mod/github.com/hashicorp/go-multierror@v1.1.1\",\n        \"GoMod\": \"/Users/testor/go/pkg/mod/cache/download/github.com/hashicorp/go-multierror/@v/v1.1.1.mod\",\n        \"GoVersion\": \"1.13\"\n}\n{\n        \"Path\": \"github.com/inconshreveable/mousetrap\",\n        \"Version\": \"v1.0.0\",\n        \"Time\": \"2014-10-17T20:07:13Z\",\n        \"Indirect\": true,\n        \"Dir\": \"/Users/testor/go/pkg/mod/github.com/inconshreveable/mousetrap@v1.0.0\",\n        \"GoMod\": \"/Users/testor/go/pkg/mod/cache/download/github.com/inconshreveable/mousetrap/@v/v1.0.0.mod\"\n}\n{\n        \"Path\": \"github.com/mitchellh/mapstructure\",\n        \"Version\": \"v1.5.0\",\n        \"Time\": \"2022-04-20T22:31:31Z\",\n        \"Dir\": \"/Users/testor/go/pkg/mod/github.com/mitchellh/mapstructure@v1.5.0\",\n        \"GoMod\": \"/Users/testor/go/pkg/mod/cache/download/github.com/mitchellh/mapstructure/@v/v1.5.0.mod\",\n        \"GoVersion\": \"1.14\"\n}\n{\n        \"Path\": \"github.com/pmezard/go-difflib\",\n        \"Version\": \"v1.0.0\",\n        \"Time\": \"2016-01-10T10:55:54Z\",\n        \"Indirect\": true,\n        \"Dir\": \"/Users/testor/go/pkg/mod/github.com/pmezard/go-difflib@v1.0.0\",\n        \"GoMod\": \"/Users/testor/go/pkg/mod/cache/download/github.com/pmezard/go-difflib/@v/v1.0.0.mod\"\n}\n{\n        \"Path\": \"github.com/russross/blackfriday/v2\",\n        \"Version\": \"v2.1.0\",\n        \"Time\": \"2020-10-27T03:47:54Z\",\n        \"Indirect\": true,\n        \"GoMod\": \"/Users/testor/go/pkg/mod/cache/download/github.com/russross/blackfriday/v2/@v/v2.1.0.mod\"\n}\n{\n        \"Path\": \"github.com/sirupsen/logrus\",\n        \"Version\": \"v1.8.1\",\n        \"Time\": \"2021-03-09T10:28:17Z\",\n        \"Dir\": \"/Users/testor/go/pkg/mod/github.com/sirupsen/logrus@v1.8.1\",\n        \"GoMod\": \"/Users/testor/go/pkg/mod/cache/download/github.com/sirupsen/logrus/@v/v1.8.1.mod\",\n        \"GoVersion\": \"1.13\"\n}\n{\n        \"Path\": \"github.com/spf13/cobra\",\n        \"Version\": \"v1.4.0\",\n        \"Time\": \"2022-03-10T15:19:35Z\",\n        \"Dir\": \"/Users/testor/go/pkg/mod/github.com/spf13/cobra@v1.4.0\",\n        \"GoMod\": \"/Users/testor/go/pkg/mod/cache/download/github.com/spf13/cobra/@v/v1.4.0.mod\",\n        \"GoVersion\": \"1.15\"\n}\n{\n        \"Path\": \"github.com/spf13/pflag\",\n        \"Version\": \"v1.0.5\",\n        \"Time\": \"2019-09-18T19:59:20Z\",\n        \"Indirect\": true,\n        \"Dir\": \"/Users/testor/go/pkg/mod/github.com/spf13/pflag@v1.0.5\",\n        \"GoMod\": \"/Users/testor/go/pkg/mod/cache/download/github.com/spf13/pflag/@v/v1.0.5.mod\",\n        \"GoVersion\": \"1.12\"\n}\n{\n        \"Path\": \"github.com/stretchr/objx\",\n        \"Version\": \"v0.1.0\",\n        \"Time\": \"2018-01-06T01:13:53Z\",\n        \"Update\": {\n                \"Path\": \"github.com/stretchr/objx\",\n                \"Version\": \"v0.4.0\",\n                \"Time\": \"2022-04-12T09:17:15Z\"\n        },\n        \"Indirect\": true,\n        \"GoMod\": \"/Users/testor/go/pkg/mod/cache/download/github.com/stretchr/objx/@v/v0.1.0.mod\"\n}\n{\n        \"Path\": \"github.com/stretchr/testify\",\n        \"Version\": \"v1.7.1\",\n        \"Time\": \"2022-03-15T21:08:43Z\",\n        \"Dir\": \"/Users/testor/go/pkg/mod/github.com/stretchr/testify@v1.7.1\",\n        \"GoMod\": \"/Users/testor/go/pkg/mod/cache/download/github.com/stretchr/testify/@v/v1.7.1.mod\",\n        \"GoVersion\": \"1.13\"\n}\n{\n        \"Path\": \"golang.org/x/crypto\",\n        \"Version\": \"v0.0.0-20191011191535-87dc89f01550\",\n        \"Time\": \"2019-10-11T19:15:35Z\",\n        \"Update\": {\n                \"Path\": \"golang.org/x/crypto\",\n                \"Version\": \"v0.0.0-20220513210258-46612604a0f9\",\n                \"Time\": \"2022-05-13T21:02:58Z\"\n        },\n        \"Indirect\": true,\n        \"GoMod\": \"/Users/testor/go/pkg/mod/cache/download/golang.org/x/crypto/@v/v0.0.0-20191011191535-87dc89f01550.mod\"\n}\n{\n        \"Path\": \"golang.org/x/mod\",\n        \"Version\": \"v0.5.1\",\n        \"Time\": \"2021-09-22T20:26:12Z\",\n        \"Dir\": \"/Users/testor/go/pkg/mod/golang.org/x/mod@v0.5.1\",\n        \"GoMod\": \"/Users/testor/go/pkg/mod/cache/download/golang.org/x/mod/@v/v0.5.1.mod\",\n        \"GoVersion\": \"1.17\"\n}\n{\n        \"Path\": \"golang.org/x/sys\",\n        \"Version\": \"v0.0.0-20191026070338-33540a1f6037\",\n        \"Time\": \"2019-10-26T07:03:38Z\",\n        \"Update\": {\n                \"Path\": \"golang.org/x/sys\",\n                \"Version\": \"v0.0.0-20220513210249-45d2b4557a2a\",\n                \"Time\": \"2022-05-13T21:02:49Z\"\n        },\n        \"Indirect\": true,\n        \"Dir\": \"/Users/testor/go/pkg/mod/golang.org/x/sys@v0.0.0-20191026070338-33540a1f6037\",\n        \"GoMod\": \"/Users/testor/go/pkg/mod/cache/download/golang.org/x/sys/@v/v0.0.0-20191026070338-33540a1f6037.mod\",\n        \"GoVersion\": \"1.12\"\n}\n{\n        \"Path\": \"golang.org/x/tools\",\n        \"Version\": \"v0.0.0-20191119224855-298f0cb1881e\",\n        \"Time\": \"2019-11-19T22:48:55Z\",\n        \"Update\": {\n                \"Path\": \"golang.org/x/tools\",\n                \"Version\": \"v0.1.10\",\n                \"Time\": \"2022-03-15T13:54:34Z\"\n        },\n        \"Indirect\": true,\n        \"GoMod\": \"/Users/testor/go/pkg/mod/cache/download/golang.org/x/tools/@v/v0.0.0-20191119224855-298f0cb1881e.mod\",\n        \"GoVersion\": \"1.11\"\n}\n{\n        \"Path\": \"golang.org/x/xerrors\",\n        \"Version\": \"v0.0.0-20191011141410-1b5146add898\",\n        \"Time\": \"2019-10-11T14:14:10Z\",\n        \"Update\": {\n                \"Path\": \"golang.org/x/xerrors\",\n                \"Version\": \"v0.0.0-20220411194840-2f41105eb62f\",\n                \"Time\": \"2022-04-11T19:48:40Z\"\n        },\n        \"Indirect\": true,\n        \"Dir\": \"/Users/testor/go/pkg/mod/golang.org/x/xerrors@v0.0.0-20191011141410-1b5146add898\",\n        \"GoMod\": \"/Users/testor/go/pkg/mod/cache/download/golang.org/x/xerrors/@v/v0.0.0-20191011141410-1b5146add898.mod\",\n        \"GoVersion\": \"1.11\"\n}\n{\n        \"Path\": \"gopkg.in/check.v1\",\n        \"Version\": \"v0.0.0-20161208181325-20d25e280405\",\n        \"Time\": \"2016-12-08T18:13:25Z\",\n        \"Update\": {\n                \"Path\": \"gopkg.in/check.v1\",\n                \"Version\": \"v1.0.0-20201130134442-10cb98267c6c\",\n                \"Time\": \"2020-11-30T13:44:42Z\"\n        },\n        \"Indirect\": true,\n        \"Dir\": \"/Users/testor/go/pkg/mod/gopkg.in/check.v1@v0.0.0-20161208181325-20d25e280405\",\n        \"GoMod\": \"/Users/testor/go/pkg/mod/cache/download/gopkg.in/check.v1/@v/v0.0.0-20161208181325-20d25e280405.mod\"\n}\n{\n        \"Path\": \"gopkg.in/yaml.v2\",\n        \"Version\": \"v2.4.0\",\n        \"Time\": \"2020-11-17T15:46:20Z\",\n        \"Indirect\": true,\n        \"GoMod\": \"/Users/testor/go/pkg/mod/cache/download/gopkg.in/yaml.v2/@v/v2.4.0.mod\",\n        \"GoVersion\": \"1.15\"\n}\n{\n        \"Path\": \"gopkg.in/yaml.v3\",\n        \"Version\": \"v3.0.0-20200313102051-9f266ea9e77c\",\n        \"Time\": \"2020-03-13T10:20:51Z\",\n        \"Update\": {\n                \"Path\": \"gopkg.in/yaml.v3\",\n                \"Version\": \"v3.0.0-20220512140231-539c8e751b99\",\n                \"Time\": \"2022-05-12T14:02:31Z\"\n        },\n        \"Dir\": \"/Users/testor/go/pkg/mod/gopkg.in/yaml.v3@v3.0.0-20200313102051-9f266ea9e77c\",\n        \"GoMod\": \"/Users/testor/go/pkg/mod/cache/download/gopkg.in/yaml.v3/@v/v3.0.0-20200313102051-9f266ea9e77c.mod\"\n}\n"

	result, err := ParseListOutput(vector)

	assert.Nil(t, err)
	assert.Equal(t, 23, len(result))

	item := result[0]
	assert.Equal(t, "github.com/omniversion/omniversion/cli", item.Name)
	assert.Equal(t, []string{"omniversion/cli"}, item.Aliases)
	assert.Equal(t, "", item.Current)
	assert.Equal(t, 1, len(item.Installations))
	assert.Equal(t, "/Users/testor/Documents/Repositories/omniversion/cli", item.Installations[0].Location)

	item = result[1]
	assert.Equal(t, "github.com/BurntSushi/toml", item.Name)
	assert.Equal(t, []string{"toml"}, item.Aliases)
	assert.Equal(t, "1.1.0", item.Current)
	assert.Equal(t, 1, len(item.Installations))
	assert.Equal(t, "/Users/testor/go/pkg/mod/github.com/!burnt!sushi/toml@v1.1.0", item.Installations[0].Location)
	assert.Equal(t, "1.1.0", item.Installations[0].Version)

	item = result[2]
	assert.Equal(t, "github.com/cpuguy83/go-md2man/v2", item.Name)
	assert.Equal(t, []string{"go-md2man/v2"}, item.Aliases)

	item = result[15]
	assert.Equal(t, "golang.org/x/crypto", item.Name)
	assert.Equal(t, []string{"crypto"}, item.Aliases)

	item = result[22]
	assert.Equal(t, "gopkg.in/yaml.v3", item.Name)
	assert.Equal(t, []string{"yaml.v3"}, item.Aliases)
}
